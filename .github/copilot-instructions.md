# Copilot / AI Assistant Instructions for travel_app

This file contains concise, actionable guidance to help an AI coding assistant be immediately productive in this Flutter project.

## Project Big Picture
- Flutter app with platform folders for Android, iOS, macOS, Linux, Windows and Web (entry in `lib/main.dart`).
- Uses Firebase + a Data Connect service for PostgreSQL; dataconnect config lives in `dataconnect/` and the generated client is under `lib/dataconnect_generated/`.
- State management uses `flutter_riverpod` (`ProviderScope` is the app root in `lib/main.dart`).

## Key Files and Directories
- `lib/main.dart`: app entry, web-specific session check, video background, and navigation flow (LandingPage -> LoginPage -> MainNavigation).
- `dataconnect/` and `dataconnect/schema/`: GraphQL schema and connector config; authoritative source for DB types (e.g., `User` has `sessionToken` and `sessionExpiry`).
- `lib/dataconnect_generated/`: auto-generated API client - do not edit directly. Calls look like `ExampleConnector.instance.getUserByToken(...).execute()`.
- `assets/videos/` and `assets/images/`: media used by the app (video background uses `assets/videos/bird_view.mp4`).
- `pubspec.yaml`: dependencies and assets. Use it to understand package versions and available plugins.

## Typical Workflows & Commands
- Install deps: `flutter pub get`.
- Generate/build code (when editing model or annotations): `flutter pub run build_runner build --delete-conflicting-outputs`.
- Run unit/widget tests: `flutter test`.
- Run the web server (useful for cookie/session testing):

  flutter run -d web-server --web-hostname=0.0.0.0 --web-port=8080

- Mobile desktop debug: `flutter run -d <device>` or use IDE run configurations.

## Project-Specific Patterns & Gotchas
- Session cookie names: DB schema and code use `sessionToken` (see `dataconnect/schema/schema.gql` and `lib/main.dart`), but `main.dart` clears `auth_token` — watch this inconsistency when modifying authentication. Prefer using the `sessionToken` name consistently.
- Auto-login flow: `LandingPage` reads a cookie (`sessionToken`), calls generated Data Connect API to validate the token, checks `sessionExpiry` and navigates with `Navigator.pushReplacement` on success. Agents editing this flow should preserve early returns to avoid updating `_isLoading` after navigation.
- Generated client usage: treat `lib/dataconnect_generated/*` as read-only. Use the connector API (e.g., `ExampleConnector.instance`) for DB reads/writes.
- Assets: videos are loaded via `VideoPlayerController.asset(...)` — keep `assets/videos/` listed in `pubspec.yaml`.
- Web compatibility: the code uses `universal_html` for reading/setting `document.cookie`. For web-only changes, ensure fallbacks for mobile platforms.

## Integrations
- Firebase: initialized in `main()` using `firebase_options.dart`. Any change to Firebase setup likely requires updating `firebase_options.dart` (generated by the Firebase CLI).
- Data Connect / Postgres: `dataconnect/` is the source of truth for DB schema; after schema changes run generator steps that produce `lib/dataconnect_generated/` artifacts.

## Editing Guidelines for AI Assistants
- Do not edit generated files in `lib/dataconnect_generated/` or files under `build/`.
- When changing auth/session code, update the cookie name consistently in `lib/main.dart`, `dataconnect/schema/schema.gql`, and any login logic in `lib/login_page.dart`.
- Preserve `ProviderScope` at app root; new providers should use Riverpod patterns already present in the codebase.
- When adding dependencies, update `pubspec.yaml` and include any new assets under `flutter.assets`.

## Small examples to follow
- Validate token use (existing):

  final response = await ExampleConnector.instance.getUserByToken(token: token).execute();
  if (response.data.users.isNotEmpty) { /* use response.data.users.first */ }

- Session cookie read (existing): `main.dart` uses `html.document.cookie` and looks for `sessionToken=`.

## What NOT to do
- Do not commit generated outputs from `lib/dataconnect_generated/` unless intentionally updating generated code as part of a generator run.
- Avoid changing the app-wide provider anchoring (`ProviderScope`) or removing Firebase initialization without coordinating other changes.

If anything here is unclear or you'd like additional examples (e.g., how to regenerate dataconnect clients, or the exact login flow in `lib/login_page.dart`), tell me which area to expand. — Copilot
